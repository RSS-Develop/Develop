<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=576, initial-scale=1.0">
    <title>Eskilstuna Info</title>
    <style>
        body {
            background-color: black;
            color: white;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            width: 100vw;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            overflow: hidden;
        }
        #eventText {
            white-space: nowrap;
            margin: 0;
            padding-left: 10px;
            line-height: 64px;
            text-align: left;
            font-size: 30px;
            width: 576px;
            height: 64px;
            overflow: hidden;
            position: relative;
        }
        .scroll-text {
            animation: marquee 15s linear infinite;
            position: absolute;
            line-height: 64px;
            padding-left: 100%;
        }
        @keyframes marquee {
            0% { transform: translateX(0); }
            100% { transform: translateX(-100%); }
        }
    </style>
</head>
<body>
    <div id="eventText">Välkommen till Eskilstuna</div>

<script>
const RSS_URL = 'https://api.rss2json.com/v1/api.json?rss_url=' + encodeURIComponent('https://visiteskilstuna.se/rest-api/rssService/getRssFeed?portletId=12.5b899160171ac5273c72ad9f&pageId=2.369be3c31580a19562d1977e');
let events = [];
let currentEventIndex = 0;
const monthMap = {
    "jan": "1", "feb": "2", "mar": "3", "apr": "4",
    "maj": "5", "jun": "6", "jul": "7", "aug": "8",
    "sep": "9", "okt": "10", "nov": "11", "dec": "12"
};

function formatDate(title) {
    const dateMatch = title.match(/(\d{1,2})\s*([a-zåäö]+)\s*([-–]\s*(\d{1,2})\s*([a-zåäö]+))?/i);
    if (!dateMatch) return '';
    
    const startDay = parseInt(dateMatch[1], 10).toString();
    const startMonth = monthMap[dateMatch[2].toLowerCase()];
    
    if (dateMatch[4] && dateMatch[5]) {
        const endDay = parseInt(dateMatch[4], 10).toString();
        const endMonth = monthMap[dateMatch[5].toLowerCase()];
        return `${startDay}/${startMonth}–${endDay}/${endMonth}`;
    }
    return `${startDay}/${startMonth}`;
}

async function fetchData() {
    try {
        const response = await fetch(RSS_URL);
        if (!response.ok) throw new Error('Kunde inte hämta data');
        
        const data = await response.json();
        events = [];
        
        data.items.forEach(item => {
            let title = item.title?.trim() || '';
            const date = formatDate(title);
            title = title.replace(/^(\d{1,2}\s*[a-zåäö]+(\s*[-–]\s*\d{1,2}\s*[a-zåäö]+)?)(\s*[,\-–:]?\s*)?/i, '').trim();
            
            if (date) {
                const fullText = `${date} ${title}`;
                events.push(fullText);
            }
        });
        
        if (events.length > 0) {
            currentEventIndex = 0;
            updateDisplay();
        }
    } catch (error) {
        console.error('Fel:', error);
        showWelcomeMessage();
    }
}

function updateDisplay() {
    const displayElement = document.getElementById('eventText');
    if (events.length > 0) {
        const currentText = events[currentEventIndex];
        displayElement.innerHTML = currentText.length > 40 ? 
            `<div class="scroll-text">${currentText}</div>` : 
            currentText;
        
        currentEventIndex = (currentEventIndex + 1) % events.length;
    } else {
        showWelcomeMessage();
    }
}

function showWelcomeMessage() {
    const displayElement = document.getElementById('eventText');
    displayElement.textContent = 'Välkommen till Eskilstuna';
}

// Initialisering
fetchData();
setInterval(fetchData, 300000);
setInterval(updateDisplay, 10000);

// Hantera window resize
let resizeTimer;
window.addEventListener('resize', () => {
    clearTimeout(resizeTimer);
    resizeTimer = setTimeout(() => {
        document.getElementById('eventText').style.animation = 'none';
        updateDisplay();
    }, 250);
});
</script>
</body>
</html>
